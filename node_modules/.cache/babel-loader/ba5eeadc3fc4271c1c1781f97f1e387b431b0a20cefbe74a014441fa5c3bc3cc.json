{"ast":null,"code":"import{usersAPI}from'../api/api';import{updateObjectInArray}from'../utils/objHelpers';const FOLLOW='FOLLOW';const UNFOLLOW='UNFOLLOW';const SET_USERS='SET_USERS';const SET_CURRENT_PAGE='SET_CURRENT_PAGE';const SET_TOTAL_COUNT='SET_TOTAL_COUNT';const TOGGLE_IS_FETCHING='TOGGLE_IS_FETCHING';const TOGGLE_FOLLOWING_PROGRESS='TOGGLE_FOLLOWING_PROGRESS';let initialState={users:[],pageSize:10,totalItemsCount:0,currentPage:1,isFetching:false,followingInProgress:[]};const usersReducer=function(){let state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;let action=arguments.length>1?arguments[1]:undefined;switch(action.type){case FOLLOW:return{...state,users:updateObjectInArray(state.users,action.userId,'id',{followed:true})};case UNFOLLOW:return{...state,users:updateObjectInArray(state.users,action.userId,'id',{followed:false})};case SET_USERS:return{...state,users:action.users};case SET_CURRENT_PAGE:return{...state,currentPage:action.currentPage};case SET_TOTAL_COUNT:return{...state,totalItemsCount:action.totalCount};case TOGGLE_IS_FETCHING:return{...state,isFetching:action.isFetching};case TOGGLE_FOLLOWING_PROGRESS:return{...state,followingInProgress:action.isFetching?[...state.followingInProgress,action.userId]:state.followingInProgress.filter(id=>id!==action.userId)};default:return state;};};//dispatch\nexport const affirmFollow=userId=>({type:FOLLOW,userId});export const affirmUnfollow=userId=>({type:UNFOLLOW,userId});export const setUsers=users=>({type:SET_USERS,users});export const setCurrentPage=currentPage=>({type:SET_CURRENT_PAGE,currentPage});export const setTotalItemsCount=totalItemsCount=>({type:SET_TOTAL_COUNT,totalCount:totalItemsCount});export const setIsFetching=isFetching=>({type:TOGGLE_IS_FETCHING,isFetching});export const toggleFollowingProgress=(isFetching,userId)=>({type:TOGGLE_FOLLOWING_PROGRESS,isFetching,userId});//thunk\nexport const requestUsers=(page,pageSize)=>{return async dispatch=>{dispatch(setIsFetching(true));dispatch(setCurrentPage(page));let data=await usersAPI.getUsers(page,pageSize);dispatch(setIsFetching(false));dispatch(setUsers(data.items));dispatch(setTotalItemsCount(data.totalCount));};};const followUnfollowFlow=async(dispatch,userId,apiMethod,actionCreator)=>{dispatch(toggleFollowingProgress(true,userId));let data=await apiMethod(userId);if(data.resultCode===0){dispatch(actionCreator(userId));};dispatch(toggleFollowingProgress(false,userId));};export const follow=userId=>{return async dispatch=>{followUnfollowFlow(dispatch,userId,usersAPI.followUser.bind(usersAPI),affirmFollow);};};export const unfollow=userId=>{return async dispatch=>{followUnfollowFlow(dispatch,userId,usersAPI.unfollowUser.bind(usersAPI),affirmUnfollow);};};export default usersReducer;","map":{"version":3,"names":["usersAPI","updateObjectInArray","FOLLOW","UNFOLLOW","SET_USERS","SET_CURRENT_PAGE","SET_TOTAL_COUNT","TOGGLE_IS_FETCHING","TOGGLE_FOLLOWING_PROGRESS","initialState","users","pageSize","totalItemsCount","currentPage","isFetching","followingInProgress","usersReducer","state","arguments","length","undefined","action","type","userId","followed","totalCount","filter","id","affirmFollow","affirmUnfollow","setUsers","setCurrentPage","setTotalItemsCount","setIsFetching","toggleFollowingProgress","requestUsers","page","dispatch","data","getUsers","items","followUnfollowFlow","apiMethod","actionCreator","resultCode","follow","followUser","bind","unfollow","unfollowUser"],"sources":["C:/Work/React/studying/my-app/src/redux/usersReducer.js"],"sourcesContent":["import { usersAPI } from '../api/api';\r\nimport { updateObjectInArray } from '../utils/objHelpers';\r\n\r\nconst FOLLOW = 'FOLLOW';\r\nconst UNFOLLOW = 'UNFOLLOW';\r\nconst SET_USERS = 'SET_USERS';\r\nconst SET_CURRENT_PAGE = 'SET_CURRENT_PAGE';\r\nconst SET_TOTAL_COUNT = 'SET_TOTAL_COUNT';\r\nconst TOGGLE_IS_FETCHING = 'TOGGLE_IS_FETCHING';\r\nconst TOGGLE_FOLLOWING_PROGRESS = 'TOGGLE_FOLLOWING_PROGRESS';\r\n\r\nlet initialState = {\r\n    users: [],\r\n    pageSize: 10,\r\n    totalItemsCount: 0,\r\n    currentPage: 1,\r\n    isFetching: false,\r\n    followingInProgress: []\r\n};\r\n\r\nconst usersReducer = (state = initialState, action) => {\r\n    switch(action.type) {\r\n        case FOLLOW:\r\n            return {\r\n                ...state,\r\n                users: updateObjectInArray(state.users, action.userId, 'id', {followed: true})\r\n            }\r\n        case UNFOLLOW:\r\n            return {\r\n                ...state,\r\n                users: updateObjectInArray(state.users, action.userId, 'id', {followed: false})\r\n            }\r\n        case SET_USERS:\r\n            return {\r\n                ...state,\r\n                users: action.users\r\n            }\r\n        case SET_CURRENT_PAGE:\r\n            return {\r\n                ...state,\r\n                currentPage: action.currentPage\r\n            }\r\n        case SET_TOTAL_COUNT:\r\n            return {\r\n                ...state,\r\n                totalItemsCount: action.totalCount\r\n            }\r\n        case TOGGLE_IS_FETCHING:\r\n            return {\r\n                ...state,\r\n                isFetching: action.isFetching\r\n            }\r\n        case TOGGLE_FOLLOWING_PROGRESS:\r\n            return {\r\n                ...state,\r\n                followingInProgress: action.isFetching \r\n                    ? [...state.followingInProgress, action.userId] \r\n                    : state.followingInProgress.filter(id => id !== action.userId)\r\n            }\r\n        default:\r\n            return state;\r\n    };\r\n};\r\n\r\n//dispatch\r\nexport const affirmFollow = (userId) => ({type: FOLLOW, userId});\r\nexport const affirmUnfollow = (userId) => ({type: UNFOLLOW, userId});\r\nexport const setUsers = (users) => ({type: SET_USERS, users});\r\nexport const setCurrentPage = (currentPage) => ({type: SET_CURRENT_PAGE, currentPage});\r\nexport const setTotalItemsCount = (totalItemsCount) => ({type: SET_TOTAL_COUNT, totalCount: totalItemsCount});\r\nexport const setIsFetching = (isFetching) => ({type: TOGGLE_IS_FETCHING, isFetching});\r\nexport const toggleFollowingProgress = (isFetching, userId) => ({type: TOGGLE_FOLLOWING_PROGRESS, isFetching, userId});\r\n\r\n//thunk\r\nexport const requestUsers = (page, pageSize) => {\r\n    return async (dispatch) => {\r\n        dispatch(setIsFetching(true));\r\n        dispatch(setCurrentPage(page));\r\n    \r\n        let data = await usersAPI.getUsers(page, pageSize);\r\n        dispatch(setIsFetching(false));\r\n        dispatch(setUsers(data.items));\r\n        dispatch(setTotalItemsCount(data.totalCount));\r\n    }\r\n};\r\n\r\nconst followUnfollowFlow = async (dispatch, userId, apiMethod, actionCreator) => {\r\n    dispatch(toggleFollowingProgress(true, userId));\r\n    let data = await apiMethod(userId);\r\n    if (data.resultCode === 0) {\r\n        dispatch(actionCreator(userId));\r\n    };\r\n    dispatch(toggleFollowingProgress(false, userId));\r\n};\r\n\r\nexport const follow = (userId) =>{\r\n    return async (dispatch) => {\r\n        followUnfollowFlow(dispatch, userId, usersAPI.followUser.bind(usersAPI), affirmFollow);\r\n    }\r\n};\r\n\r\nexport const unfollow = (userId) =>{\r\n    return async (dispatch) => {\r\n        followUnfollowFlow(dispatch, userId, usersAPI.unfollowUser.bind(usersAPI), affirmUnfollow);\r\n    }\r\n};\r\n\r\nexport default usersReducer;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}